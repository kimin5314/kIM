# PrivateIM 需求文档

## 1. 项目概述
**项目名称**：kIM

**目标**：构建一个供个人及小圈子使用的 **自托管 IM 服务器**，支持基本聊天功能，并具备 **隐私保护** 特性。

**用户群体**：
- 个人使用（自托管聊天）
- 朋友间小规模聊天（私有服务器）
- 具备技术能力的用户（可自行部署）

**核心特性**：
- **私聊 & 群聊**
- **公共聊天室**
- **自托管，轻量级架构**
- **基础消息存储**（无复杂加密）
- **支持多端同步**

---

## 2. 功能需求

### 2.1 用户管理
- [ ] 用户注册 / 登录（轻量级，无需 OIDC）
- [ ] 昵称 / 头像设置（可选）
- [ ] 本地存储用户数据（轻量级数据库）

### 2.2 即时通讯
- [ ] **私聊**（1 对 1 聊天）
- [ ] **群聊**（支持基础群组）
- [ ] **公共聊天室**（所有用户可加入）
- [ ] **离线消息存储**
- [ ] **消息撤回 & 编辑**（可选）

### 2.3 文件 & 媒体
- [ ] 发送 **图片 / 文件**（可选）
- [ ] 服务器存储 **基础文件管理**

---

## 3. 非功能性需求

### 3.1 轻量级架构
- **适合小规模自托管**（低资源占用）
- **PostgreSQL 作为存储**
- **Docker 容器化部署支持**

### 3.2 安全性（基础）
- **支持 TLS 传输加密**（服务器不解析消息内容）
- **本地存储可选加密**
- **基本防滥用措施**

---

## 4. 技术选型

### 4.1 后端
- **语言**：python
- **通信协议**：WebSocket + REST API
- **数据库**：SQLite / PostgreSQL
- **文件存储**：本地存储或 MinIO

### 4.2 前端
- **Web 端**：Vue

---

## 5. API 设计（示例）

### 5.1 用户 API
```http
POST /api/register
Content-Type: application/json
{
  "username": "user123",
  "password": "securepassword"
}
```
```http
POST /api/login
Content-Type: application/json
{
  "username": "user123",
  "password": "securepassword"
}
```

### 5.2 消息 API
```http
POST /api/message/send
Content-Type: application/json
{
  "sender": "user123",
  "receiver": "user456",
  "content": "Hello, world!"
}
```
```http
GET /api/message/history?user=user456
```

---

## 6. 部署 & 运维

### 6.1 开发环境

### 6.2 生产环境

---

## 7. 未来扩展（可选）
- [ ] **端到端加密（E2EE）**
- [ ] **更强的群聊功能**
- [ ] **插件支持**

---

## 8. 版本规划
| 版本 | 主要特性 |
|------|-------------------------|
| v1.0 | 基础 IM 功能（私聊、群聊、公聊） |
| v1.1 | 文件发送支持 |
| v1.2 | 消息撤回 & 编辑 |
| v2.0 | 可选端到端加密 |

---

## 9. 结论
- **第一阶段**：构建 **最小化可行聊天服务器**
- **后续扩展**：根据需求增加加密、文件传输等
